"use strict";(self.webpackChunkqtrobot_documentation=self.webpackChunkqtrobot_documentation||[]).push([[9544],{44462:function(e,t,o){o.r(t),o.d(t,{frontMatter:function(){return l},contentTitle:function(){return d},metadata:function(){return p},toc:function(){return u},default:function(){return m}});var n=o(87462),r=o(63366),a=(o(67294),o(3905)),i=o(18477),s=o(14702),c=["components"],l={id:"js_ros_interfaces",title:"Using QTrobot with JavaScript",hide_table_of_contents:!0},d=void 0,p={unversionedId:"tutorials/javascript/js_ros_interfaces",id:"tutorials/javascript/js_ros_interfaces",isDocsHomePage:!1,title:"Using QTrobot with JavaScript",description:"signalcellularalt &nbsp;Level:&nbsp; Intermediate",source:"@site/docs/tutorials/javascript/js_ros_interfaces.md",sourceDirName:"tutorials/javascript",slug:"/tutorials/javascript/js_ros_interfaces",permalink:"/docs/tutorials/javascript/js_ros_interfaces",tags:[],version:"current",frontMatter:{id:"js_ros_interfaces",title:"Using QTrobot with JavaScript",hide_table_of_contents:!0},sidebar:"code_tutorials_sidebar",previous:{title:"ROS motor controller for QTrobot",permalink:"/docs/tutorials/cpp/cpp_motor_controller"}},u=[{value:"Setting up rosbridge_server for QTrobot",id:"setting-up-rosbridge_server-for-qtrobot",children:[],level:2},{value:"Download qtrobot.js and its dependencies",id:"download-qtrobotjs-and-its-dependencies",children:[],level:2},{value:"Write a simple code using qtrobot.js",id:"write-a-simple-code-using-qtrobotjs",children:[],level:2},{value:"Run and check the code",id:"run-and-check-the-code",children:[],level:2}],h={toc:u};function m(e){var t=e.components,o=(0,r.Z)(e,c);return(0,a.kt)("wrapper",(0,n.Z)({},h,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Overview")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)(i.Z,{mdxType:"Icon"},"signal_cellular_alt")," ",(0,a.kt)(s.Z,{mdxType:"Markdown"},"\xa0**Level:**\xa0 *Intermediate*"),(0,a.kt)("br",null)," ",(0,a.kt)(i.Z,{mdxType:"Icon"}," track_changes ")," ",(0,a.kt)(s.Z,{mdxType:"Markdown"},"\xa0**Goal:**\xa0 *learn how to access QTrobot interfaces such as speech, emotion, gesture, etc. in JavaScript and HTML*"),(0,a.kt)("br",null)," ",(0,a.kt)(i.Z,{mdxType:"Icon"}," task_alt ")," ",(0,a.kt)(s.Z,{mdxType:"Markdown"},"\xa0**Requirements:**"),(0,a.kt)("ul",{parentName:"div"},(0,a.kt)("li",{parentName:"ul"},"\xa0","\xa0",(0,a.kt)("a",{parentName:"li",href:"/docs/intro_code"},"Quick start with coding on QTrobot")),(0,a.kt)("li",{parentName:"ul"},"\xa0","\xa0","Good knowledge of JavaScript and HTML")),(0,a.kt)(i.Z,{mdxType:"Icon"},"code")," ",(0,a.kt)(s.Z,{mdxType:"Markdown"},"\xa0**Code:**\xa0 [view source](https://github.com/luxai-qtrobot/software/blob/master/sdk/jscript/examples/simple/index.html)"))),(0,a.kt)("p",null,"In this tutorial we will learn about how to access ",(0,a.kt)("a",{parentName:"p",href:"/docs/api_ros#list-of-available-interfaces"},"QTrobot interfaces")," such as speech and audio interface from a JavaScript code. There are different scenarios in which you may need to access ROS topics and services from a web browser-based application. In this tutorial we will show you how to setup Rosbridge to communicate with other ROS nodes in JavaScript. We also explain how easily you can access QTrobot interfaces such as speech and motor control from HTML using JavaScript. "),(0,a.kt)("p",null,"Our JavaScript code will communicates with QTrobot via Rosbridge suite. Rosbridge is a meta package which connect ROS nodes to the applications outside ROS networks by providing  JSON APIs to ROS functionality. There are a variety of front ends that interface with Rosbridge , including a WebSocket server for web browsers (i.e. rosbridge_server). However, for the sake of simplicity and to facilitate code development, we have developed the ",(0,a.kt)("strong",{parentName:"p"},"qtrobot.js")," ",(0,a.kt)("a",{parentName:"p",href:"/docs/api_js"},"SDK for QTrobot"),". It is a wrapper over roslibjs which facilitate establishing connection with QTrobot rosbridge and expose simple APIs to interact with the robot."),(0,a.kt)("h2",{id:"setting-up-rosbridge_server-for-qtrobot"},"Setting up rosbridge_server for QTrobot"),(0,a.kt)("p",null,"In most cases, a rosbridge_server is already running on your QTrobot. However, for many recent versions of the QTrobot, the rosbridge_server is configured with SSL and dedicated authentication mechanism. However, for the sake of the simplicity, we configure and launch a new instance of the rosbridge_server on ",(0,a.kt)("strong",{parentName:"p"},"QTPC"),". "),(0,a.kt)("p",null,"Open a terminal on QTPC and install the rosbridge-suite package:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install ros-`rosversion -d`-rosbridge-suite\n")),(0,a.kt)("p",null,"To avoid conflict with any running Rosbridge, we create a new launch file and overwrite some parameters. Create a launch file in QTPC home folder (",(0,a.kt)("inlineCode",{parentName:"p"},"~/rosbridge_websocket_qtpc.launch"),") with the following content:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<launch> \n   <include ns="qtpc" file="$(find rosbridge_server)/launch/rosbridge_websocket.launch"> \n      <arg name="port" value="9091" /> \n   </include> \n</launch>\n')),(0,a.kt)("p",null,"Launch the ",(0,a.kt)("inlineCode",{parentName:"p"},"rosbridge_websocket_qtpc.launch")," and check the setup: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"roslaunch ~/rosbridge_websocket_qtpc.launch\n")),(0,a.kt)("p",null,"You should see similar messages printed out as the following output after launching our instance of Rosbridge: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"...\n2021-08-26 16:05:06+0200 [-] [INFO] [1629986706.721006]: Rosbridge WebSocket server started at ws://0.0.0.0:9091\n")),(0,a.kt)("h2",{id:"download-qtrobotjs-and-its-dependencies"},"Download qtrobot.js and its dependencies"),(0,a.kt)("p",null,"To keep our code clean, lets create some folders and download the required ",(0,a.kt)("em",{parentName:"p"},"js")," files: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir -p ~/tutorial_qt_jscript/js\ncd ~/tutorial_qt_jscript/js\nwget https://raw.githubusercontent.com/luxai-qtrobot/software/master/sdk/jscript/qtrobot-1.0.min.js\nwget https://raw.githubusercontent.com/luxai-qtrobot/software/master/sdk/jscript/roslib.min.js\nwget https://raw.githubusercontent.com/luxai-qtrobot/software/master/sdk/jscript/eventemitter2.min.js\n")),(0,a.kt)("h2",{id:"write-a-simple-code-using-qtrobotjs"},"Write a simple code using qtrobot.js"),(0,a.kt)("p",null,"Now we have our qtrobot.js in place, lets write a simple code to communicate with QTrobot interfaces. Create a html file (",(0,a.kt)("inlineCode",{parentName:"p"},"index.html"),") in our project directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"touch ~/tutorial_qt_jscript/index.html\n")),(0,a.kt)("p",null,"and add the following content: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n<head>    \n    <meta charset="UTF-8">\n    <script src="js/roslib.min.js"><\/script>\n    <script src="js/eventemitter2.min.js"><\/script>\n    <script src="js/qtrobot-1.0.min.js"><\/script>\n</head>\n\n<body>\n<script>    \nvar url = prompt("Please enter QTrobot rosbridge url:", "ws://192.168.100.2:9091");\nurl = (url == null) ? \'ws://127.0.0.1:9091\' : url;\nvar qtrobot = null;\ndocument.addEventListener(\'DOMContentLoaded\', function () {\n    console.log("connecting to QTrobot (please wait...)");\n    qtrobot = new QTrobot({\n        url : url,\n        connection: function(){            \n            console.log("connected to " + url);\n            qtrobot.talk_text(\'Hello! my name is QT!\', function(){\n                qtrobot.show_emotion(\'QT/happy\');\n            });        \n        },\n        error: function(error){\n            console.log(error);\n        },\n        close: function(){\n            console.log("disconnected.");\n        }\n    }); //end of qtrobot\n\n}); // end of DOMContentLoaded\n<\/script>\n\n<p style="text-align: center;"> Open your browser console to see the output!</p>\n</body>\n</html>\n')),(0,a.kt)("p",null,"Before running the code, let's take a look at what we have wrote. We created an html file and added our JavaScript code to be executed on html document onload event. Our JavaScript code first asks us to enter the URL of our Rosbridge instance. Because we are running it on QTPC, we can confirm its default value which is ",(0,a.kt)("inlineCode",{parentName:"p"},"ws://192.168.100.2:9091"),". Notice that ",(0,a.kt)("inlineCode",{parentName:"p"},"192.168.100.2")," is the IP of QTPC and '9091' is the port number which we had already set it up for Rosbridge in our launch file. "),(0,a.kt)("p",null,"Then we created an instance of \u2018QTrobot\u2019 object with the correct URL of our rosbridge websocket server. The QTrobot instance connects to the given URL and upon success the \u2018connection\u2019 callback is called. The qtrobot.js library automatically tries to reconnect to the server if for any reason the connection goes down. After\nconnecting to the QTrobot rosbridge_server, we called ",(0,a.kt)("inlineCode",{parentName:"p"},"talk_text"),' method which asks QTrobot to say "Hello!...". After QTrobot finishes playing our message, it shows the happy emotion. This is because we called ',(0,a.kt)("inlineCode",{parentName:"p"},"show_emotion")," method in the callback of ",(0,a.kt)("inlineCode",{parentName:"p"},"talk_text")," method. Thus, the ",(0,a.kt)("inlineCode",{parentName:"p"},"show_emotion")," method will be executed after finishing the ",(0,a.kt)("inlineCode",{parentName:"p"},"talk_text")," method."),(0,a.kt)("h2",{id:"run-and-check-the-code"},"Run and check the code"),(0,a.kt)("p",null,"To run our code, simply open the ",(0,a.kt)("inlineCode",{parentName:"p"},"index.html"),' file in a browser on QTPC. You should hear that QTrobot says "Hello!..." and then shows the happy face. To see the output of log messages in console, open the browser console. '),(0,a.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Tip")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("ul",{parentName:"div"},(0,a.kt)("li",{parentName:"ul"},"In Google chrome you can press ",(0,a.kt)("inlineCode",{parentName:"li"},"CTRL+SHIFT+C")," to open the developer console and navigate to console message window."),(0,a.kt)("li",{parentName:"ul"},"In Firefox, simply right-click on the browser content and choose ",(0,a.kt)("em",{parentName:"li"},"Inspect")," or press ",(0,a.kt)("inlineCode",{parentName:"li"},"Q"),". Then navigate to console message window.")))),(0,a.kt)("p",null,"You can find more complex examples (e.g. using Vue.js) on ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/luxai-qtrobot/software/tree/master/sdk/jscript/examples/vue.js"},"QTrobot JavaScript repository"),"."))}m.isMDXComponent=!0}}]);