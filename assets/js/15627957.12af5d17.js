"use strict";(self.webpackChunkqtrobot_documentation=self.webpackChunkqtrobot_documentation||[]).push([[6669],{6537:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>n,metadata:()=>a,toc:()=>l});var r=o(5893),s=o(1151);const n={id:"processor",title:"QTrobot Computation and networking",hide_table_of_contents:!1},i=void 0,a={id:"modules/processor",title:"QTrobot Computation and networking",description:"QTrobot comes with two computers: i) QTRP, a Raspberry Pi based computer to control the main hardware and ii) QTPC, an Intel\xae NUC i5/i7 PC to provide more computational power and to accelerate software development cycle. Both computers run on Ubuntu/Debian Linux operating systems and leverage ROS to offer easy-to-use yet very flexible software architecture. QTrobot's hardware is easily extendable via USB-C and USB adaptors, for example, to connect external monitor, keyboard and mouse and sensors.",source:"@site/versioned_docs/version-QTRD_v1/modules/processor.mdx",sourceDirName:"modules",slug:"/modules/processor",permalink:"/docs/v1/modules/processor",draft:!1,unlisted:!1,tags:[],version:"QTRD_v1",frontMatter:{id:"processor",title:"QTrobot Computation and networking",hide_table_of_contents:!1},sidebar:"modules",previous:{title:"QTrobot Motion and Actuators",permalink:"/docs/v1/modules/motors"}},c={},l=[{value:"Operating systems",id:"operating-systems",level:2},{value:"Networking",id:"networking",level:2},{value:"ROS setup",id:"ros-setup",level:2},{value:"Catkin workspace",id:"catkin-workspace",level:3},{value:"QTrobot startup process",id:"qtrobot-startup-process",level:2},{value:"What are autostart scripts?",id:"what-are-autostart-scripts",level:3},{value:"QTRP autostart scripts",id:"qtrp-autostart-scripts",level:3},{value:"QTPC autostart scripts",id:"qtpc-autostart-scripts",level:3},{value:"How to check the log files of autostart scripts",id:"how-to-check-the-log-files-of-autostart-scripts",level:3},{value:"How to run my own script at startup",id:"how-to-run-my-own-script-at-startup",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["QTrobot comes with two computers: ",(0,r.jsx)(t.em,{children:"i)"})," ",(0,r.jsx)(t.strong,{children:"QTRP"}),", a Raspberry Pi based computer to control the main hardware and ",(0,r.jsx)(t.em,{children:"ii)"})," ",(0,r.jsx)(t.strong,{children:"QTPC"}),", an Intel\xae NUC i5/i7 PC to provide more computational power and to accelerate software development cycle. Both computers run on Ubuntu/Debian Linux operating systems and leverage ROS to offer easy-to-use yet very flexible software architecture. QTrobot's hardware is easily extendable via USB-C and USB adaptors, for example, to connect external monitor, keyboard and mouse and sensors."]}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)("img",{src:"/img/processor.png",alt:"display"})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(t.p,{children:"As it is shown in the above diagram, QTRP (in QTrobot's head) is internally connected to QTPC (in QTrobot's body) via ethernet cable. All of the QTrobot devices such as display, speakers, microphone and motors are connected to QTRP except the 3D Camera which is connected directly to QTPC. The Wi-Fi of the QTRP is used to create the QTrobot hotspot with the same SSID as the robot\u2019s serial number (e.g. QTRD000101)."}),"\n",(0,r.jsx)(t.h2,{id:"operating-systems",children:"Operating systems"}),"\n",(0,r.jsxs)(t.p,{children:["The older versions of QTrobot came with Ubuntu 16. However, we have updated the operating system of both integrated QTrobot\u2019s computers to the latest stable version of Linux.  The Nuc PC (QTPC) comes with ",(0,r.jsx)(t.strong,{children:"Ubuntu 20.04 LTS"})," and the Raspberry Pi board (QTRP) at the head uses the latest version of ",(0,r.jsx)(t.strong,{children:"Raspberry Pi OS (Debian Buster)"}),". Both computers are updated to latest stable version of ",(0,r.jsx)(t.strong,{children:"ROS Noetic"})," with ",(0,r.jsx)(t.strong,{children:"Python 3"})," as default. The latest is particularly interesting because its opens accessing wider list of open-source software and libraries which use Python 3 such as recent machine and deep learning libraries, voice processing and recognition software."]}),"\n",(0,r.jsx)(t.h2,{id:"networking",children:"Networking"}),"\n",(0,r.jsx)(t.p,{children:"One of the very interesting features of the recent QTrobots, is the new networking architecture. The following diagram demonstrates a common scenario where different devices (e.g., laptops) are connected to the QTrobot via its Wi-Fi hotspot. The Wi-Fi of RaspberryPi is setup to operate in AP/STA mode. That means the RaspberryPi's Wi-Fi can be connected to a home router (as Wi-Fi client) and at the same time operates as hotspot (access point). This has some distinct advantages: By connecting the Wi-Fi of RaspberryPi to the home/office router with the internet, Nuc PC and any other devices which are connected to the hotspot of the QTrobot also get access to the internet.  Moreover, laptops and other devices which are in the same network as the home router, can be easily configured to access and control QTrobot via ROS."}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)("img",{src:"/img/network2.png",width:"70%"})}),"\n",(0,r.jsx)(t.admonition,{title:"Note",type:"important",children:(0,r.jsxs)(t.p,{children:["Due to Raspberry Pi's Wi-Fi AP/STA mode limitation, not more than ",(0,r.jsx)(t.strong,{children:"two"})," devices can simultaneously connect to QTrobot's hotspot. If you need to connect more than two devices to QTrobot, you can connect them via an external access point such as your home/office router.  Please follow ",(0,r.jsx)(t.a,{href:"/docs/intro_code#qt_to_internet",children:(0,r.jsx)(t.strong,{children:"Connect QTrobot to a home network and Internet"})})," instruction, then connect your other devices (e.g. laptop) to the same router to access the same network as QTrobot."]})}),"\n",(0,r.jsx)(t.h2,{id:"ros-setup",children:"ROS setup"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"roscore"})," runs on QTRP  automatically at QTrobot boot time. The QTPC is setup with the correct ",(0,r.jsx)(t.code,{children:"ROS_MASTER_URI"})," and ",(0,r.jsx)(t.code,{children:"ROS_IP"})," to access the same ROS network as QTRP. Usually ROS master URI is set to ",(0,r.jsx)(t.code,{children:"192.168.4.1"})," or ",(0,r.jsx)(t.code,{children:"192.168.100.1"})," depending on the QTrobot's version. However, you can easily check it by looking into ",(0,r.jsx)(t.code,{children:"/home/qtrobot/.bash_aliases"})," file on QTRP:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"source /opt/ros/noetic/setup.bash\nsource ~/catkin_ws/devel/setup.bash\nROBOT_IP=192.168.4.1\nexport ROS_MASTER_URI=http://${ROBOT_IP}:11311\n"})}),"\n",(0,r.jsx)(t.p,{children:"The ROS environment is setup in different files on QTRP to make it available to other users (e.g. root user):"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["in  ",(0,r.jsx)(t.code,{children:"/home/qtrobot/.bash_aliases"})]}),"\n",(0,r.jsxs)(t.li,{children:["in ",(0,r.jsx)(t.code,{children:"/etc/environment"})]}),"\n",(0,r.jsxs)(t.li,{children:["and in ",(0,r.jsx)(t.code,{children:"/etc/profile"})]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"catkin-workspace",children:"Catkin workspace"}),"\n",(0,r.jsxs)(t.p,{children:["For both QTRP and QTPC, the Catkin workspace is already set up and is accessible under ",(0,r.jsx)(t.code,{children:"/home/qtrobot/catkin_ws"})," folder.  The workspaces also contains some important ROS nodes for QTrobot interfaces such as ",(0,r.jsx)(t.code,{children:"qt_nuitrack_app"}),", ",(0,r.jsx)(t.code,{children:"qt_vosk_app"})," and etc. Indeed you can use the same catkin workspace for your own developments but be careful to not remove the ",(0,r.jsx)(t.code,{children:"src"})," folder within catkin workspace."]}),"\n",(0,r.jsx)(t.admonition,{title:"Warning",type:"danger",children:(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["You do not need and ",(0,r.jsx)(t.strong,{children:"should not"})," run another instance of ",(0,r.jsx)(t.code,{children:"roscore"})," neither on QTPC nor QTRP nor any other machine which are in the ROS network of QTrobot."]}),"\n",(0,r.jsxs)(t.li,{children:["Do ",(0,r.jsx)(t.strong,{children:"not delete"})," the default ",(0,r.jsx)(t.code,{children:"catkin_ws"})," folders on QTRP nor on QTPC. These folder already used for running some default QTrobot interface nodes such as ",(0,r.jsx)(t.code,{children:"qt_nuitrack_app"})," on QTPC or ",(0,r.jsx)(t.code,{children:"qt_vosk_app"})," on QTRP."]}),"\n"]})}),"\n",(0,r.jsx)(t.h2,{id:"qtrobot-startup-process",children:"QTrobot startup process"}),"\n",(0,r.jsxs)(t.p,{children:["The following diagram depicts the ",(0,r.jsx)(t.strong,{children:"default process"})," of QTrobot's startup. Upon turning on the robot  (either by plugin the power line or by pressing the power button), the QTRP will boot and set up the network for Lan, Wi-Fi hotspot and connecting to the home/office router (if set up). Then it runs the ",(0,r.jsx)(t.code,{children:"roscore"})," and launch the QTrobot interfaces such as ",(0,r.jsx)(t.code,{children:"qt_motor"}),", ",(0,r.jsx)(t.code,{children:"qt_robot_interface"})," and etc. When the basic interfaces is up and running, it then turn on QTPC via wake-on-lan. QTPC then boot up and start the ",(0,r.jsx)(t.code,{children:"qt_nuitrack_app"})," interface."]}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)(t.mermaid,{chart:'graph LR\n  A(Power on <br/> QTrobot) --\x3e B(turn on <br/> QTRP);\n  B --\x3e B1("Setup networks<br/>ROS environment")\n  B1 --\x3e C(Run motor, face <br/> and other interfaces)\n  B1 --\x3e D(turn on QTPC <br/> via Wake-On-Lan)\n  D --\x3e E(Run nuitrack interface)\n\n  style A fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style B fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style B1 fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style C fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style D fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style E fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030   '})}),"\n",(0,r.jsx)(t.p,{children:"Powering off QTrobot almost follows the reverse procedure of powering on. The QTrobot's power button is connected to Raspberry PI and trigs the power off procedure of QTRP. During the shut down process of QTRP, it also sends power off command to QTPC via SSH so that both computers turn off using a single power button. Below is an overview of the power-off process of QTrobot."}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)(t.mermaid,{chart:'graph RL  \n  A(Power off <br/> QTrobot) --\x3e B(start shuting down <br/> QTRP);\n  B --\x3e D(stop motor, face <br/> and other interfaces)\n  B --\x3e C("Shutdown QTPC <br/> via SSH command")   \n  C --\x3e E(Stop nuitrack interface)\n\n  style A fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style B fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style C fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style D fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style E fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030   '})}),"\n",(0,r.jsx)(t.h3,{id:"what-are-autostart-scripts",children:"What are autostart scripts?"}),"\n",(0,r.jsxs)(t.p,{children:["QTrobot uses some startup scripts (i.e. autostart scripts) for both QTRP and QTPC to start and launch its software and drivers at boot time. Autostart scripts are simply some bash scripts which are executed at QTrobot startup time. There are different set of autostart scripts, one for QTRP and the other set for QTPC. Generally, these scripts prepare QTrobot network, setup ROS environment and launch specific ROS nodes on each machine. For example, autostart scripts of QTRP, run roscore and launch QTrobot motor and other important controllers. Moreover, as it can be inferred from ",(0,r.jsx)(t.a,{href:"#1-qtrobot-architecture",children:"QTrobot Architecture"}),", one of the autostart scripts of QTPC is  responsible to launch the ",(0,r.jsx)(t.code,{children:"qt_nuitrack_app"})," node which provide ROS interface for Nuitrack skeleton tracking using 3D camera. Therefore, ",(0,r.jsx)(t.strong,{children:"it is very important that you completely understand the purpose of each script"})," before disabling or modifying the QTrobot autostart behavior."]}),"\n",(0,r.jsxs)(t.p,{children:["For both QTRP and QTPC, the autostart scripts are located in ",(0,r.jsx)(t.code,{children:"~/robot/autostart"})," folder under ",(0,r.jsx)(t.code,{children:"qtrobot"})," user. The scripts are run by Linux ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Cron",children:"Cron"})," job scheduler. In fact, a specific cron job is configured to run the ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})," script at boot time. The other scripts are launched by ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})," and their output are redirected to the corresponding log files."]}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)(t.mermaid,{chart:"flowchart LR;\n    A(Cron job) --\x3e B(autostart_screens.sh);\n    B--\x3eC(start_script_1.sh);\n    B--\x3eD(start_script_2.sh);   \n    B--\x3eE(start_script_3.sh);   \n  style A fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style B fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style C fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style D fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030 \n  style E fill:#f0f0f0,stroke:614b7f,stroke-width:2px,color:#303030   "})}),"\n",(0,r.jsx)(t.h3,{id:"qtrp-autostart-scripts",children:"QTRP autostart scripts"}),"\n",(0,r.jsxs)(t.p,{children:["the ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})," script on QTRP is responsible for launching the ",(0,r.jsx)(t.code,{children:"roscore"})," and some other QTRobot critical interfaces such as ",(0,r.jsx)(t.code,{children:"qt_motor"}),", ",(0,r.jsx)(t.code,{children:"qt_robot_interface"}),", etc.  Please be careful to not disable any of these critical nodes. Here is the list and short descriptions of each autostart script on QTRP:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_mDNS.sh"})," : start mulitcast discovery service on QTrobot"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_roscore.sh"})," : run the roscore"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_qtpc.sh"})," : turn on QTPC via wake-on-lan"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_qt_motor.sh"})," : launch qt_motor node (for motor, gesture interfaces and etc)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_qt_robot_interface.sh"})," : launch qt_robot_interface node (for robot facial emotion, speech, interfaces and etc.)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_qt_rosbridge.sh"})," : start a secure rosbridge server (used by tablet apps)"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_qt_vosk_app.sh"})," : start vosk offline speech recogntion"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"qtpc-autostart-scripts",children:"QTPC autostart scripts"}),"\n",(0,r.jsxs)(t.p,{children:["the ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})," script on QTPC is mainly responsible for launching the ",(0,r.jsx)(t.code,{children:"qt_nuitrack_app"})," interface.  Here is the list and short descriptions of each autostart script on QTPC:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"start_qt_nuitrack_app.sh"})," : launch qt_nuitrack_app node (for skeleton tracking, facial feature, gesture recognition and etc.)"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"how-to-check-the-log-files-of-autostart-scripts",children:"How to check the log files of autostart scripts"}),"\n",(0,r.jsxs)(t.p,{children:["All programs/ROS nodes which are run by QTrobot autostart scripts redirect their standard output (info/war/error messages) to their corresponding log file. These log files can be found under ",(0,r.jsx)(t.code,{children:"~/robot/autostart/logs"})," folder."]}),"\n",(0,r.jsx)(t.h3,{id:"how-to-run-my-own-script-at-startup",children:"How to run my own script at startup"}),"\n",(0,r.jsxs)(t.p,{children:["For example, to run your custom script on QTPC at the startup, you need to first create a startup script file and call it from ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"}),". Do the following steps:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"[Step 1]"})," Create custom startup script"]}),"\n",(0,r.jsxs)(t.p,{children:["open a terminal on QTPC and create a bash script file. Let's name it ",(0,r.jsx)(t.code,{children:"start_my_script.sh"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"nano ~/robot/autostart/start_my_script.sh\n"})}),"\n",(0,r.jsx)(t.p,{children:"with the following example content:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'# !/bin/bash\nsource /home/qtrobot/robot/autostart/qt_robot.inc\n\nSCRIPT_NAME="start_my_script"\nLOG_FILE=$(prepare_logfile "$SCRIPT_NAME")\n\n{\nprepare_ros_environment\nwait_for_ros_node "/rosout" 60\n# ...\n# add your main code here\n/usr/bin/echo "This is my script!"        \n# ...\n} &>> ${LOG_FILE}\n'})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"[Step 2]"})," Add it to ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})]}),"\n",(0,r.jsxs)(t.p,{children:["Carefully edit the ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"nano ~/robot/autostart/autostart_screens.sh\n"})}),"\n",(0,r.jsxs)(t.p,{children:["To add your own script (e.g. ",(0,r.jsx)(t.code,{children:"start_my_script.sh"}),") you can simply add the following line to the buttom of ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})," right before the ",(0,r.jsx)(t.code,{children:"} &>> ${LOG_FILE}"})," line.\nThe ",(0,r.jsx)(t.code,{children:"autostart_screens.sh"})," should look like the following:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'{\nwait_for_network        \n...\n...\nrun_script "start_my_script.sh"\n} &>> ${LOG_FILE}\n'})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"[Step 3]"})," Reboot and check\nReboot the QTrobot. After reboot, your script should be executed on startup of QTPC. You can now check the log file of your script:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"cat ~/robot/austostart/logs/start_my_script.log\n"})}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);