"use strict";(self.webpackChunkqtrobot_documentation=self.webpackChunkqtrobot_documentation||[]).push([[8875],{63372:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return m},assets:function(){return d},toc:function(){return h},default:function(){return _}});var o=n(87462),a=n(63366),i=(n(67294),n(3905)),s=n(55381),r=n(14702),p=["components"],c={id:"python_ros_expression",title:"Human facial expression detection",hide_table_of_contents:!0},l="Human facial expression detection",m={unversionedId:"tutorials/python/python_ros_expression",id:"tutorials/python/python_ros_expression",title:"Human facial expression detection",description:"signalcellularalt &nbsp;Level:&nbsp; Intermediate",source:"@site/docs/tutorials/python/python_ros_expression_detection.md",sourceDirName:"tutorials/python",slug:"/tutorials/python/python_ros_expression",permalink:"/docs/tutorials/python/python_ros_expression",tags:[],version:"current",frontMatter:{id:"python_ros_expression",title:"Human facial expression detection",hide_table_of_contents:!0},sidebar:"code_tutorials_sidebar",previous:{title:"Commanding QTrobot motors",permalink:"/docs/tutorials/python/python_ros_motors"},next:{title:"Human gesture detection",permalink:"/docs/tutorials/python/python_ros_gestures"}},d={},h=[{value:"Create a python project",id:"create-a-python-project",level:2},{value:"Code",id:"code",level:2},{value:"Explanation",id:"explanation",level:2}],u={toc:h};function _(e){var t=e.components,n=(0,a.Z)(e,p);return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"human-facial-expression-detection"},"Human facial expression detection"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Overview")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)(s.Z,{mdxType:"Icon"},"signal_cellular_alt")," ",(0,i.kt)(r.Z,{mdxType:"Markdown"},"\xa0**Level:**\xa0 *Intermediate*"),(0,i.kt)("br",null)," ",(0,i.kt)(s.Z,{mdxType:"Icon"}," track_changes ")," ",(0,i.kt)(r.Z,{mdxType:"Markdown"},"\xa0**Goal:**\xa0 *learn how to detect Human facial expressions with QTrobot Nuitrack interface*"),(0,i.kt)("br",null)," ",(0,i.kt)(s.Z,{mdxType:"Icon"}," task_alt ")," ",(0,i.kt)(r.Z,{mdxType:"Markdown"},"\xa0**Requirements:**"),(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"\xa0","\xa0",(0,i.kt)("a",{parentName:"li",href:"/docs/intro_code"},"Quick start with coding on QTrobot")),(0,i.kt)("li",{parentName:"ul"},"\xa0","\xa0",(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/python/python_ros_project"},"Create a ROS python project")),(0,i.kt)("li",{parentName:"ul"},"\xa0","\xa0",(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/python/python_ros_publish"},"QTrobot interfaces using ROS Topics")),(0,i.kt)("li",{parentName:"ul"},"\xa0","\xa0",(0,i.kt)("a",{parentName:"li",href:"/docs/tutorials/python/python_ros_subscribe"},"QTrobot interfaces using ROS Subscribers"))))),(0,i.kt)("p",null,"In this tutorial we will learn how to detect Human facial expressions with ",(0,i.kt)("a",{parentName:"p",href:"/docs/api_ros#human-3d-tracking-interface"},"QTrobot Nuitrack interface")," using ROS Subscribes. "),(0,i.kt)("h2",{id:"create-a-python-project"},"Create a python project"),(0,i.kt)("p",null,"First we create a python project for our tutorial. let's call it ",(0,i.kt)("inlineCode",{parentName:"p"},"tutorial_qt_expressions")," and add the required python file: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'cd ~/catkin_ws/src\ncatkin_create_pkg tutorial_qt_expressions std_msgs rospy roscpp -D "Reading human face expressions"\ncd tutorial_qt_expressions/src\ntouch tutorial_qt_expressions_node.py\nchmod +x tutorial_qt_expressions_node.py\n')),(0,i.kt)("h2",{id:"code"},"Code"),(0,i.kt)("p",null,"Open the ",(0,i.kt)("inlineCode",{parentName:"p"},"tutorial_qt_expressions_node.py")," file and add the following code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'#!/usr/bin/env python\nimport sys\nimport rospy\nfrom std_msgs.msg import String\nfrom qt_nuitrack_app.msg import Faces\nfrom qt_robot_interface.srv import *\n\n\ndef face_callback(msg):\n    emotions = [msg.faces[0].emotion_angry, msg.faces[0].emotion_happy, msg.faces[0].emotion_surprise]\n    em = max(emotions)\n    em_index = emotions.index(em)\n    if em_index == 0 and em >= 0.9:\n        speech_pub.publish("It looks like you are angry! This is my angry face")\n        emotionShow("QT/angry")\n        rospy.sleep(2)\n    elif em_index == 1 and em >= 0.9:\n        speech_pub.publish("You are happy! This is my happy face")\n        emotionShow("QT/happy")\n        rospy.sleep(2)\n    elif em_index == 2 and em >= 0.9:\n        speech_pub.publish("This is surprising!")\n        emotionShow("QT/surprise")\n        rospy.sleep(2)\n    \n    \nif __name__ == \'__main__\':\n    rospy.init_node(\'my_tutorial_node\')\n    rospy.loginfo("my_tutorial_node started!")\n\n    emotionShow = rospy.ServiceProxy(\'/qt_robot/emotion/show\', emotion_show)\n    speech_pub = rospy.Publisher(\'/qt_robot/speech/say\', String, queue_size=1)\n\n    # define ros subscriber\n    rospy.Subscriber(\'/qt_nuitrack_app/faces\', Faces, face_callback)\n   \n    try:\n        rospy.spin()\n    except KeyboardInterrupt:\n        pass\n\n    rospy.loginfo("finsihed!")\n\n')),(0,i.kt)("h2",{id:"explanation"},"Explanation"),(0,i.kt)("p",null,"First we imported ",(0,i.kt)("inlineCode",{parentName:"p"},"Faces")," message type from ",(0,i.kt)("inlineCode",{parentName:"p"},"qt_nuitrack_app.msg")," message library. This message type is used in communication with ",(0,i.kt)("inlineCode",{parentName:"p"},"/qt_nuitrack_app/faces"),". "),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"How do we know which messages an interface uses? well, There is a useful command in ROS which tells you that: "),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"rostopic info /qt_nuitrack_app/faces\nType: qt_nuitrack_app/Faces\n...\n")))),(0,i.kt)("p",null,"Then we created a subscriber for",(0,i.kt)("inlineCode",{parentName:"p"},"/qt_nuitrack_app/faces")," with callback function ",(0,i.kt)("inlineCode",{parentName:"p"},"face_callback"),".\nIn the callback we react accordingly to what is detected. We check all the emotions that are detected and we use the one which has the highest rating. If we detect happy emotion we also make QTrobot show happy emotion."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'def face_callback(msg):\n    emotions = [msg.faces[0].emotion_angry, msg.faces[0].emotion_happy, msg.faces[0].emotion_surprise]\n    em = max(emotions)\n    em_index = emotions.index(em)\n    if em_index == 0 and em >= 0.9:\n        speech_pub.publish("It looks like you are angry! This is my angry face")\n        emotionShow("QT/angry")\n        rospy.sleep(2)\n    elif em_index == 1 and em >= 0.9:\n        speech_pub.publish("You are happy! This is my happy face")\n        emotionShow("QT/happy")\n        rospy.sleep(2)\n    elif em_index == 2 and em >= 0.9:\n        speech_pub.publish("This is surprising!")\n        emotionShow("QT/surprise")\n        rospy.sleep(2)\n')),(0,i.kt)("p",null,"Stand in front of QTrobot and smile or make an angry face.\nWhen QTrobot detects the emotion, it will repeat the same emotion as you showed."))}_.isMDXComponent=!0}}]);