<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-modules/microphone" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">QTrobot Audio processing and Microphone | QTrobot Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.luxai.com/docs/modules/microphone"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="QTrobot Audio processing and Microphone | QTrobot Documentation"><meta data-rh="true" name="description" content="QTrobot has an integrated High-performance digital microphones array in the head. It is a ReSpeaker Mic Array v2.0 board from SeedStudio with plenty of features such as voice activity detection, direction of arrival, beamforming and noise Suppression. This powerful microphone can be used in variety of scenarios such as voice interaction, interactive vision-voice applications, multichannel raw audio recording and processing and etc. It is connected to Raspberry Pi (QTRP) via USB port and it is open for developers to freely tune, configure and use it in standard ways."><meta data-rh="true" property="og:description" content="QTrobot has an integrated High-performance digital microphones array in the head. It is a ReSpeaker Mic Array v2.0 board from SeedStudio with plenty of features such as voice activity detection, direction of arrival, beamforming and noise Suppression. This powerful microphone can be used in variety of scenarios such as voice interaction, interactive vision-voice applications, multichannel raw audio recording and processing and etc. It is connected to Raspberry Pi (QTRP) via USB port and it is open for developers to freely tune, configure and use it in standard ways."><link data-rh="true" rel="icon" href="/img/luxai-favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.luxai.com/docs/modules/microphone"><link data-rh="true" rel="alternate" href="https://docs.luxai.com/docs/modules/microphone" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.luxai.com/docs/modules/microphone" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NHG3L6L4QM-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="QTrobot Documentation" href="/opensearch.xml">
<!-- Google Tag Manager -->
              <script>var ck=document.cookie;let internal=ck.search("internalTraffic=true");function enableGTM(){!function(e,t,n,a,o){e[a]=e[a]||[],e[a].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var r=t.getElementsByTagName(n)[0],c=t.createElement(n);c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id=GTM-KQ6W3F7",r.parentNode.insertBefore(c,r)}(window,document,"script","dataLayer")}-1==internal&&(console.log("Cookie not set!"),enableGTM())</script>
              <!-- End Google Tag Manager -->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="/assets/css/styles.7837df0c.css">
<script src="/assets/js/runtime~main.288bcd80.js" defer="defer"></script>
<script src="/assets/js/main.6096d0bc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_luxai_mini.png" alt="LuxAI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_luxai_mini.png" alt="LuxAI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Visual Scripting</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/intro_graphical">Quick start</a></li><li><a class="dropdown__link" href="/docs/tutorials/intro_studio">Tutorials</a></li><li><a class="dropdown__link" href="/docs/blocks_api">Blocks reference</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Coding</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/intro_code">Quick start</a></li><li><a class="dropdown__link" href="/docs/tutorials/intro_ros">Tutorials</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/modules/display">Competences</a></li><li><a class="dropdown__link" href="/docs/api_ros">API references</a></li></ul></div><a class="navbar__item navbar__link" href="/demos">Demos</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/intro_code">QTrobot V2</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/modules/microphone">QTrobot V2</a></li><li><a class="dropdown__link" href="/docs/v1/modules/microphone">QTrobot V1</a></li></ul></div><a class="navbar__item navbar__link" href="/support">Support</a><a href="https://github.com/luxai-qtrobot" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/modules/display">Face and Emotion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/modules/speakers">Sound and Speech</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/modules/microphone">Audio Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/modules/camera">Vision System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/modules/motors">Motion and Actuators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/modules/processor">Computation and Networking</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Audio Processing</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: QTrobot V2</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>QTrobot Audio processing and Microphone</h1></header><p>QTrobot has an integrated High-performance digital microphones array in the head. It is a <a href="https://wiki.seeedstudio.com/ReSpeaker_Mic_Array_v2.0/" target="_blank" rel="noopener noreferrer"><strong>ReSpeaker Mic Array v2.0</strong></a> board from SeedStudio with plenty of features such as voice activity detection, direction of arrival, beamforming and noise Suppression. This powerful microphone can be used in variety of scenarios such as voice interaction, interactive vision-voice applications, multichannel raw audio recording and processing and etc. It is connected to Raspberry Pi (QTRP) via USB port and it is open for developers to freely tune, configure and use it in standard ways.</p>
<center><img src="/img/microphone.png" alt="microphone"></center>
<p><strong>Specification:</strong></p>
<ul>
<li>4 High-performance digital microphones</li>
<li>supports far-field voice capture</li>
<li>Speech algorithm on-chip</li>
<li>12 programmable RGB LED indicators</li>
<li>Microphones: ST MP34DT01TR-M</li>
<li>Sensitivity: -26 dBFS (omnidirectional)</li>
<li>Acoustic overload point: 120 dB SPL</li>
<li>SNR: 61 dB</li>
<li>Max Sample Rate:16Khz</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="software-interfaces">Software interfaces<a href="#software-interfaces" class="hash-link" aria-label="Direct link to Software interfaces" title="Direct link to Software interfaces">​</a></h2>
<p>Like any other standard microphones, the QTrobot Respeaker microphone is an standard Linux capture device which is managed by ALSA driver. Bellow you can see the output of <code>arecord -l</code> command which lists all capture devices in QTRP:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">**** List of CAPTURE Hardware Devices ****</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">card 2: ArrayUAC10 [ReSpeaker 4 Mic Array (UAC1.0)], device 0: USB Audio [USB Audio]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Subdevices: 0/1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Subdevice #0: subdevice #0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>QTrobot comes with following pre-installed software for speech recognition, accessing raw raw microphone data and tuning tool. These software interfaces are installed on QTRP because direct access to the microphone device is required.</p>
<ul>
<li><a href="https://github.com/luxai-qtrobot/software/tree/master/apps/qt_respeaker_app" target="_blank" rel="noopener noreferrer"><strong>qt_respeaker_app</strong></a>: ROS services for streaming multichannel microphone audio data, voice activity, voice direction and etc. (<strong>running by default</strong>)</li>
<li><a href="https://github.com/luxai-qtrobot/software/tree/master/tools/respeaker_mic_tunning" target="_blank" rel="noopener noreferrer"><strong>respeaker_mic_tuning</strong></a>: A graphical tools for detailed tuning of Respeaker microphone</li>
</ul>
<p>Installed on QTPC:</p>
<ul>
<li><a href="https://github.com/luxai-qtrobot/software/tree/master/apps/qt_vosk_app" target="_blank" rel="noopener noreferrer"><strong>qt_vosk_app</strong></a>: an <em>offline</em> and multilingual speech recognition ROS service based on VOSK library. (<strong>running by default</strong>)</li>
<li><a href="https://github.com/luxai-qtrobot/software/tree/master/apps/qt_gspeech_app" target="_blank" rel="noopener noreferrer"><strong>qt_gspeech_app</strong></a>: an <em>online</em> and multilingual speech recognition ROS service based on Google Speech-To-Text API</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="offline-speech-recognition">Offline speech recognition<a href="#offline-speech-recognition" class="hash-link" aria-label="Direct link to Offline speech recognition" title="Direct link to Offline speech recognition">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>QTrobot AI@Edge</div><div class="admonitionContent_BuS1"><p>By default there is no speech recognition enabled, but you can easily setup <a href="https://github.com/luxai-qtrobot/software/tree/master/apps/qt_riva_asr_app" target="_blank" rel="noopener noreferrer"><strong>qt_riva_asr_app</strong></a> to have offline speech recognition on the QTrobot.</p></div></div>
<p>QTrobot uses <code>qt_vosk_app</code> for offline speech recognition. The <code>qt_vosk_app</code> is installed in QTPC <code>~/catkin_ws</code> and it is running by default. Some of the required language models for speech recognitions are installed in <code>~/robot/vosk/models</code> in QTPC such as <code>en_US</code> for English, <code>de_DE</code> for German, <code>fr_FR</code> for French languages.
You can try and use the speech recognitions in different ways.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-voice-recognition-from-terminal">Accessing voice recognition from terminal<a href="#accessing-voice-recognition-from-terminal" class="hash-link" aria-label="Direct link to Accessing voice recognition from terminal" title="Direct link to Accessing voice recognition from terminal">​</a></h3>
<p>Like many other ROS services, you can call <code>/qt_robot/speech/recognize</code> with the desired language and options. The options can be used to tell the service to stop and return the recognized words as soon one of the given options is detected.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ rosservice call /qt_robot/speech/recognize </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;language: &#x27;en_US&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">options:[]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">timeout: 0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-voice-recognition-from-code">Accessing voice recognition from code<a href="#accessing-voice-recognition-from-code" class="hash-link" aria-label="Direct link to Accessing voice recognition from code" title="Direct link to Accessing voice recognition from code">​</a></h3>
<p>Take a look at our <a href="/docs/tutorials/python/python_ros_vosk"><strong>Python offline speech recognition</strong></a> tutorial to learn how to call <code>qt_vosk_app</code> services from a Python code. Here is also a Python code snippet:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> qt_vosk_app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">srv </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">recognize </span><span class="token operator">=</span><span class="token plain"> rospy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ServiceProxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/qt_robot/speech/recognize&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> speech_recognize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resp </span><span class="token operator">=</span><span class="token plain"> recognize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;en_US&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;blue&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;green&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;red&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;I got: %s&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> resp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">transcript</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-voice-recognition-using-qtrobot-visual-studio-blocks">Accessing voice recognition using QTrobot visual studio blocks<a href="#accessing-voice-recognition-using-qtrobot-visual-studio-blocks" class="hash-link" aria-label="Direct link to Accessing voice recognition using QTrobot visual studio blocks" title="Direct link to Accessing voice recognition using QTrobot visual studio blocks">​</a></h3>
<p>QTrobot studio offers very flexible and powerful blocks to handle complex ROS messages and interact with other publishers, subscribers and services. You can follow <a href="/docs/tutorials/graphical/studio_ros"><strong>Using ROS blocks</strong></a> tutorial to learn how to call <code>qt_vosk_app</code> using QTrobot visual studio blocks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-more-languages">Installing more languages<a href="#installing-more-languages" class="hash-link" aria-label="Direct link to Installing more languages" title="Direct link to Installing more languages">​</a></h3>
<p>If your required language is not already installed on the robot, you can go through the following steps to add it to the <code>qt_vosk_app</code>:</p>
<ol>
<li>find the proper model of your desired language from <a href="https://alphacephei.com/vosk/models" target="_blank" rel="noopener noreferrer">https://alphacephei.com/vosk/models</a> list.</li>
<li>Download and unzip the model into <code>~/robot/vosk/models</code> QTPC  folder.</li>
<li>Rename the model folder to the short language code (ISO) such as <code>it_IT</code> for Italian.</li>
<li>relaunch <code>qt_vosk_app</code> or simply reboot the QTrobot.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="online-speech-recognition">Online speech recognition<a href="#online-speech-recognition" class="hash-link" aria-label="Direct link to Online speech recognition" title="Direct link to Online speech recognition">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Always check if you have the latest code of the &#x27;qt_gspeech_app&#x27; on your QTPC. You can check with &#x27;git status&#x27; command in the &#x27;~/robot/code/software&#x27; folder.</p><p>Latest update (10. May 2023):</p><ol>
<li>Enabled Automatic punctuation</li>
<li>Default Timeout of 5 min: call the service with timeout=0 to enable it</li>
<li>BUG FIX: Sometimes Google speech recognition would return empty response when providing timeout in rosservice call, use default timeout instead</li>
</ol></div></div>
<p>The <a href="https://github.com/luxai-qtrobot/software/tree/master/apps/qt_gspeech_app" target="_blank" rel="noopener noreferrer"><strong>qt_gspeech_app</strong></a>
provides an <strong>online</strong> (required INTERNET connection) multilingual speech recognition ROS service based on Google Speech-To-Text API. The <code>qt_gspeech_app</code> is not running by default and it <strong>cannot</strong> be run simultaneously with other voice apps such as <code>qt_vosk_app</code>. To disable the <code>qt_vosk_app</code>, you can simply comment the corresponding line in <code>~/robot/autostart/autostart_screens.sh</code> on QTPC and reboot the robot.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-instructions">Setup instructions<a href="#setup-instructions" class="hash-link" aria-label="Direct link to Setup instructions" title="Direct link to Setup instructions">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="google-account-and-api-credentials">Google account and API credentials<a href="#google-account-and-api-credentials" class="hash-link" aria-label="Direct link to Google account and API credentials" title="Direct link to Google account and API credentials">​</a></h4>
<p>Please follow the setup instructions to <a href="https://cloud.google.com/speech-to-text/docs/quickstart-client-libraries#before-you-begin" target="_blank" rel="noopener noreferrer"><strong>setup your google account</strong></a> before enabling the <code>qt_gspeech_app</code>.</p>
<p>Export your google api credentials in .json file and save it on the QTPC.</p>
<p>Edit and add to the last line in <code>~/.bash_aliases</code> file:</p>
<p>export GOOGLE_APPLICATION_CREDENTIALS=<code>&lt;path-to-your-file&gt;</code>
<em>example</em>:&quot;/home/qtrobot/credentials.json&quot;</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="python-virtualenvironment">Python virtualenvironment<a href="#python-virtualenvironment" class="hash-link" aria-label="Direct link to Python virtualenvironment" title="Direct link to Python virtualenvironment">​</a></h4>
<p>We recommend you use <a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="noopener noreferrer">python virtual environments</a> to install all python modules and setup the google speech recognition.</p>
<ol>
<li>Install python virtual environment:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> python3.8-venv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>Navigate to &#x27;qt_gspeech_app&#x27; folder:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> ~/robot/code/software/apps/qt_gspeech_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>Setup virtual environment:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">python3 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-m</span><span class="token plain"> venv .venv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>To use is you just need to activate it:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> .venv/bin/activate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>install all python modules and plugins inside this virtual environment.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="link-to-catkin-workspace-and-build">Link to catkin workspace and build<a href="#link-to-catkin-workspace-and-build" class="hash-link" aria-label="Direct link to Link to catkin workspace and build" title="Direct link to Link to catkin workspace and build">​</a></h4>
<p>To be able to use rosservice you need to link the code to the catkin workspace and build it:</p>
<ol>
<li>navigate to catkin workspace:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> ~/catkin_ws/src</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>link the qt_gspeech_app:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-s</span><span class="token plain"> /home/qtrobot/robot/code/software/apps/qt_gspeech_app </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>rebuild catkin workspace:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> ~/catkin_ws </span><span class="token operator">&amp;&amp;</span><span class="token plain"> caktin_make </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">-j4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="autostart">Autostart<a href="#autostart" class="hash-link" aria-label="Direct link to Autostart" title="Direct link to Autostart">​</a></h4>
<p>To enable it in autostart script (<code>~/robot/autostart/autostart_screens.sh</code>) on QTPC follow next steps:</p>
<ol>
<li>edit autostart_screen.sh</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">nano</span><span class="token plain"> ~/robot/autostart/autostart_screens.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and add this line below other scripts:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">run_script </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;start_qt_gspeech_app.sh&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>create &quot;start_qt_gspeech_app.sh&quot;<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">nano</span><span class="token plain"> ~/robot/autostart/start_qt_gspeech_app.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<!-- -->add and edit the following content:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># !/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> /home/qtrobot/robot/autostart/qt_robot.inc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SCRIPT_NAME</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;start_qt_gspeech_app&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">LOG_FILE</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">prepare_logfile </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;</span><span class="token variable string variable" style="color:rgb(189, 147, 249);font-style:italic">$SCRIPT_NAME</span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> prepare_ros_environment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> wait_for_ros_node </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/rosout&quot;</span><span class="token plain"> </span><span class="token number">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> /home/qtrobot/catkin_ws/src/qt_gspeech_app/.venv/bin/activate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> python /home/qtrobot/catkin_ws/src/qt_gspeech_app/src/qt_gspeech_app_node.py</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token operator">&amp;&gt;&gt;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${LOG_FILE}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>save the file and reboot the QTrobot</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-voice-recognition-from-terminal-1">Accessing voice recognition from terminal<a href="#accessing-voice-recognition-from-terminal-1" class="hash-link" aria-label="Direct link to Accessing voice recognition from terminal" title="Direct link to Accessing voice recognition from terminal">​</a></h3>
<p>Similar to the offline version of speech recognition, the interface can be accessed using ROS Service <code>/qt_robot/speech/recognize</code> command line tools as shown bellow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">rosservice call /qt_robot/speech/recognize </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;language: &#x27;en_US&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">options:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">- &#x27;&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">timeout: 10&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can refer to the instruction given above for the offline version of the voice recognition to use the <code>qt_gspeech_app</code> service in a Python code or using QTrobot visual studio blocks.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If you would like to use <code>qt_vosk_app</code> and <code>qt_gspeech_app</code> at the same time, then you will need to change rosservice that they are providing. By default both of them are using &quot;qt_robot/speech/recognize&quot;.</p><p>To change the rosservice for qt_gspeech_app follow the next steps on QTPC:</p><ol>
<li>cd ~/robot/code/software/apps/qt_gspeech_app/src</li>
<li>edit qt_gspeech_app_node.py line 67:</li>
</ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">self.speech_recognize </span><span class="token operator">=</span><span class="token plain"> rospy.Service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/qt_robot/speech/recognize&#x27;</span><span class="token plain">, speech_recognize, self.callback_recognize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Change &#x27;qt_robot/speech/recognize&#x27; to &#x27;qt_robot/gspeech/recognize&#x27;
3. save the file
4. next time you run &#x27;qt_gspeech_app&#x27; it will be available on &#x27;qt_robot/gspeech/recognize&#x27; rosservice</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tips-for-better-speech-recognition"><strong>Tips</strong> for better speech recognition<a href="#tips-for-better-speech-recognition" class="hash-link" aria-label="Direct link to tips-for-better-speech-recognition" title="Direct link to tips-for-better-speech-recognition">​</a></h2>
<p></p><style data-emotion="css 1jgtvd5">.css-1jgtvd5{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;overflow:hidden;display:inline-block;text-align:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;font-size:1.5rem;}</style><span class="material-icons notranslate MuiIcon-root MuiIcon-fontSizeMedium css-1jgtvd5" aria-hidden="true"> lightbulb </span>  The microphone is installed on top of the QTrobot&#x27;s head. Therefore, it is always better to talk to QTrobot from above (higher than robot) the robot so that your voice can clearly reaches the microphone. <br><p></p>
<p><br> </p><style data-emotion="css 1jgtvd5">.css-1jgtvd5{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;overflow:hidden;display:inline-block;text-align:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;font-size:1.5rem;}</style><span class="material-icons notranslate MuiIcon-root MuiIcon-fontSizeMedium css-1jgtvd5" aria-hidden="true"> lightbulb </span>  For faster and more reactive speech recognition, provide proper options (if applicable) to the service call. For example, if you only need to recognize <code>yes</code> or <code>no</code> in a sentence, give these values as options so that the service immediately return one of these two values as soon being detected by engine. <br><p></p>
<p><br> </p><style data-emotion="css 1jgtvd5">.css-1jgtvd5{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;overflow:hidden;display:inline-block;text-align:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;font-size:1.5rem;}</style><span class="material-icons notranslate MuiIcon-root MuiIcon-fontSizeMedium css-1jgtvd5" aria-hidden="true"> lightbulb </span>  In case of <code>qt_vosk_app</code>, there might be delay from the moment you switch the language at run-time until the engine loads the model and start analyzing the voice. This is related ONLY to the first call for switching the language.<p></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-audio-voice-direction-and-other-data">Accessing audio, voice direction and other data<a href="#accessing-audio-voice-direction-and-other-data" class="hash-link" aria-label="Direct link to Accessing audio, voice direction and other data" title="Direct link to Accessing audio, voice direction and other data">​</a></h2>
<p>The <a href="https://github.com/luxai-qtrobot/software/tree/master/apps/qt_respeaker_app" target="_blank" rel="noopener noreferrer"><strong>qt_respeaker_app</strong></a> provide ROS services for streaming multichannel microphone audio data, voice activity, voice direction and etc. Here is a list of the topics which are published by <code>qt_respeaker_app</code>:</p>
<ul>
<li>
<p><code>/qt_respeaker_app/channel0</code>: processed audio for ASR (mix of 4 microphones data)</p>
</li>
<li>
<p><code>/qt_respeaker_app/channel1</code> : mic1 raw data</p>
</li>
<li>
<p><code>/qt_respeaker_app/channel2</code> : mic2 raw data</p>
</li>
<li>
<p><code>/qt_respeaker_app/channel3</code> : mic3 raw data</p>
</li>
<li>
<p><code>/qt_respeaker_app/channel4</code> : mic4 raw data</p>
</li>
<li>
<p><code>/qt_respeaker_app/channel5</code> : merged playback</p>
</li>
<li>
<p><code>/qt_respeaker_app/is_speaking</code>: VAD (Voice Activity Detection)</p>
</li>
<li>
<p><code>/qt_respeaker_app/sound_direction</code>: DOA (Direction of Arrival)</p>
</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>When using VOD values, please not that <code>270</code> indicates to the front of QTrobot due to the microphone orientation in the robot&#x27;s head.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-qt_respeaker_app">Configuring qt_respeaker_app<a href="#configuring-qt_respeaker_app" class="hash-link" aria-label="Direct link to Configuring qt_respeaker_app" title="Direct link to Configuring qt_respeaker_app">​</a></h3>
<p>The <code>qt_respeaker_app</code> is already installed in the <code>~/catkin_ws</code> folder on QTRP. There is a config file <code>qt_respeaker_app.yaml</code> in the app folder which can be used to configure the Respeaker microphone especially with tuning parameters. Here are  some of the default tuning parameters:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">qt_respeaker_app</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">suppress_pyaudio_error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">update_rate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">10.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">tuning</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">AGCGAIN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">50.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">AGCONOFF</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">CNIONOFF</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">GAMMA_NS_SR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1.8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">MIN_NS_SR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">STATNOISEONOFF_SR</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For most of the cases the default parameters should just work fine for you. However, you may need to adjust some of these values such as <code>AGCGAIN</code> to have loader (more gain) in streamed audio or <code>MIN_NS_SR</code> and <code>GAMMA_NS_SR</code> to better eliminate background noises such as QTrobot internal fan&#x27;s noise.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recording-raw-audio-data">Recording raw audio data<a href="#recording-raw-audio-data" class="hash-link" aria-label="Direct link to Recording raw audio data" title="Direct link to Recording raw audio data">​</a></h3>
<p>The <code>qt_respeaker_app</code> streams each microphone channel&#x27;s data in seperate topics: <code>/qt_respeaker_app/channel0 - 5</code>. To record any or multiple of these channels, you can simply subscribes to the correspondig channels from QTPC (or any other computer in ROS network) and store the audio data in a WAV file or other audio formats. You can take a looke at <a href="https://github.com/luxai-qtrobot/software/blob/master/apps/qt_respeaker_app/examples/audio_record.py" target="_blank" rel="noopener noreferrer">audio_record.py</a> examples to see how to record <code>/qt_respeaker_app/channel0</code> in a <code>.wav</code> file. Here is also a simple code snippet:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> wave</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> audio_common_msgs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">msg </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> AudioData</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">channel_callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">writeframes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wf </span><span class="token operator">=</span><span class="token plain"> wave</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;audio.wav&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;wb&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">setnchannels</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">setsampwidth</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">setframerate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">16000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rospy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Subscriber</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/qt_respeaker_app/channel0&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> AudioData</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> channel_callback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The above code snippet records processed audio for ASR from channel 0 and save it in <code>audio.wav</code> file.  You can later process or listen to it.
By default some tuning parameters for noise reduction and automatic gain level are set in <code>config/qt_respeaker_app.yaml</code>. If, for example, you need to record audio with different gain level, you can simply change the <code>AGCGAIN: 100.0</code> and reluach the <code>qt_respeaker_app</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="microphone-tuning-tool">Microphone tuning tool<a href="#microphone-tuning-tool" class="hash-link" aria-label="Direct link to Microphone tuning tool" title="Direct link to Microphone tuning tool">​</a></h2>
<p>We have developed <a href="https://github.com/luxai-qtrobot/software/tree/master/tools/respeaker_mic_tunning" target="_blank" rel="noopener noreferrer"><strong>respeaker_mic_tuning</strong></a> graphical tools based on <a href="https://github.com/respeaker/usb_4_mic_array" target="_blank" rel="noopener noreferrer">ReSpeaker USB 4 Mic Array tuning software</a> to easier find and tune the Respeaker microphone  parameters. Using the gui, you can tune the parameters at runtime and find the one that value which best fits your scenario such as different audio gain level or different background noise elimination.</p>
<center><img src="/img/tunning_gui.png" alt="tunning_gui"></center>
<p>The tool is available in QTRP under <code>~/robot/code/software/tools/</code> folder. To run it:</p>
<ul>
<li>Open a terminal on QTPC (with display attached to the robot)</li>
<li>SSH to QTRP using <code>-X</code> paramter: <code>ssh -X qtrp</code></li>
<li>switch to the <code>~/robot/code/software/tools/respeaker_mic_tunning</code> folder</li>
<li>run the tuning tool: <code>python3 ./tunning_gui.py</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-can-i-tune">What can I tune?<a href="#what-can-i-tune" class="hash-link" aria-label="Direct link to What can I tune?" title="Direct link to What can I tune?">​</a></h3>
<p>You can find the best value and tune each Respeaker parameter depending on your need. You may need to learn and got some knowledge of audio signal processing to understand all these parameters. However, in most cases you simply need to adjust the following paramters of the Respeaker microphone:</p>
<ul>
<li><code>AGCONOFF</code>: to turn of or on automatic gain control. When it is &#x27;OFF&#x27;, the audio will be captured with a constant gain set by <code>AGCGAIN</code>.</li>
<li><code>AGCGAIN</code>: the sudio signal gain value. Higher value will results loader (higher volume) audio streamed signal.</li>
<li><code>GAMMA_NS_SR</code> and <code>MIN_NS_SR</code>: these two values together specify how much background noise should be eleminated. these values already set up in QTrobot to supress and eliminate the background noise from internal fan. You can adjust these values to have more clear audio signal.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-can-i-do-with-the-tunned-values">What can I do with the tunned values?<a href="#what-can-i-do-with-the-tunned-values" class="hash-link" aria-label="Direct link to What can I do with the tunned values?" title="Direct link to What can I do with the tunned values?">​</a></h3>
<p>The <code>respeaker_mic_tuning</code> temporary adjusts the paramters of Respeaker microphone. However, values of these paramters will be reseted after rebooting the robot.
therefore, when you find the currect values which fits your application scenario, you can use those values to confgiure the corresponding QTrobot interfaces.
For example, by setting them in <code>qt_respeaker_app.yaml</code> for <code>qt_respeaker_app</code> or use them to configure within your own code. here is simple code snippet to set Respeaker&#x27;s paramters via a Python code:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> usb</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">core</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> tuning </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Tuning</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mic </span><span class="token operator">=</span><span class="token plain"> usb</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">find</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">idVendor</span><span class="token operator">=</span><span class="token number">0x2886</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> idProduct</span><span class="token operator">=</span><span class="token number">0x0018</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dev </span><span class="token operator">=</span><span class="token plain"> Tuning</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;AGCONOFF&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;AGCGAIN&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">100.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can take a look at our <a href="https://github.com/luxai-qtrobot/software/blob/master/apps/qt_vosk_app/src/qt_vosk_app_node.py" target="_blank" rel="noopener noreferrer">qt_vosk_app_node.py</a> as a reference code.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/modules/speakers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">QTrobot Sound and Speech</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/modules/camera"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">QTrobot Vision and 3D Camera</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#software-interfaces" class="table-of-contents__link toc-highlight">Software interfaces</a></li><li><a href="#offline-speech-recognition" class="table-of-contents__link toc-highlight">Offline speech recognition</a><ul><li><a href="#accessing-voice-recognition-from-terminal" class="table-of-contents__link toc-highlight">Accessing voice recognition from terminal</a></li><li><a href="#accessing-voice-recognition-from-code" class="table-of-contents__link toc-highlight">Accessing voice recognition from code</a></li><li><a href="#accessing-voice-recognition-using-qtrobot-visual-studio-blocks" class="table-of-contents__link toc-highlight">Accessing voice recognition using QTrobot visual studio blocks</a></li><li><a href="#installing-more-languages" class="table-of-contents__link toc-highlight">Installing more languages</a></li></ul></li><li><a href="#online-speech-recognition" class="table-of-contents__link toc-highlight">Online speech recognition</a><ul><li><a href="#setup-instructions" class="table-of-contents__link toc-highlight">Setup instructions</a></li><li><a href="#accessing-voice-recognition-from-terminal-1" class="table-of-contents__link toc-highlight">Accessing voice recognition from terminal</a></li></ul></li><li><a href="#tips-for-better-speech-recognition" class="table-of-contents__link toc-highlight"><strong>Tips</strong> for better speech recognition</a></li><li><a href="#accessing-audio-voice-direction-and-other-data" class="table-of-contents__link toc-highlight">Accessing audio, voice direction and other data</a><ul><li><a href="#configuring-qt_respeaker_app" class="table-of-contents__link toc-highlight">Configuring qt_respeaker_app</a></li><li><a href="#recording-raw-audio-data" class="table-of-contents__link toc-highlight">Recording raw audio data</a></li></ul></li><li><a href="#microphone-tuning-tool" class="table-of-contents__link toc-highlight">Microphone tuning tool</a><ul><li><a href="#what-can-i-tune" class="table-of-contents__link toc-highlight">What can I tune?</a></li><li><a href="#what-can-i-do-with-the-tunned-values" class="table-of-contents__link toc-highlight">What can I do with the tunned values?</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Visual Scripting</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro_graphical">Quick start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/intro_studio">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/blocks_api">Blocks reference</a></li><li class="footer__item"><a href="https://qtrobot.luxai.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">QTrobot Studio</a></li></ul></div><div class="col footer__col"><div class="footer__title">Coding</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro_code">Quick start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/intro_ros">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/modules/display">Competences</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api_ros">API references</a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/luxai-qtrobot/software" target="_blank" rel="noopener noreferrer" class="footer__link-item">Software</a></li><li class="footer__item"><a href="https://github.com/luxai-qtrobot/tutorials" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorials</a></li><li class="footer__item"><a href="https://github.com/luxai-qtrobot/QA/issues?q=is%3Aopen+is%3Aissue+label%3Aquestion" target="_blank" rel="noopener noreferrer" class="footer__link-item">Q&amp;A</a></li></ul></div><div class="col footer__col"><div class="footer__title">LuxAI S.A.</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://luxai.com/humanoid-social-robot-for-research-and-teaching/" target="_blank" rel="noopener noreferrer" class="footer__link-item">QTrobot for research</a></li><li class="footer__item"><a href="https://luxai.com/assistive-tech-robot-for-special-needs-education/" target="_blank" rel="noopener noreferrer" class="footer__link-item">QTrobot for schools</a></li><li class="footer__item"><a href="https://luxai.com/shop/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Shop</a></li><li class="footer__item"><a class="footer__link-item" href="/support">Get support</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://luxai.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/luxai-favicon.ico" alt="LuxAI" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/luxai-favicon.ico" alt="LuxAI" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">Copyright © 2023 LuxAI S.A.</div></div></div></footer></div>
</body>
</html>